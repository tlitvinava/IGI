<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Автосервисы</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    button { padding: 10px 20px; font-size: 16px; }
    .card {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 15px;
      margin: 10px 0;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .card h3 { margin: 0 0 10px 0; }

  .spinner {
    border: 4px solid #f3f3f3;
    border-top: 4px solid #007BFF;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    animation: spin 1s linear infinite;
    margin: 20px auto;
    display: none;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  </style>
</head>
<body>
  <h1>Поиск автосервисов в Минске</h1>
  <button onclick="getAutoServices()">Получить автосервисы из Overpass API</button>
  <div id="spinner" class="spinner"></div>
  <div id="results"></div>

  <script>
   async function getAutoServices() {
  const spinner = document.getElementById('spinner');
  const container = document.getElementById('results');
  container.innerHTML = '';
  spinner.style.display = 'block'; // показать спиннер

  const query = `
    [out:json][timeout:25];
    (
      node["shop"="car_repair"](around:7000,53.9,27.56667);
      way["shop"="car_repair"](around:7000,53.9,27.56667);
      relation["shop"="car_repair"](around:7000,53.9,27.56667);
    );
    out center;
  `;

  try {
    const url = 'https://corsproxy.io/?https://overpass-api.de/api/interpreter';
    const response = await fetch(url, {
      method: 'POST',
      body: query,
    });

    const data = await response.json();
    const filtered = data.elements.filter(el => {
      const tags = el.tags || {};
      return tags.name && tags['addr:street'] && tags['addr:housenumber'] && tags.website && tags.phone;
    });

    filtered.forEach(el => {
      const tags = el.tags;
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <h3>${tags.name}</h3>
        <p><strong>Улица:</strong> ${tags['addr:street']}, ${tags['addr:housenumber']}</p>
        <p><strong>Телефон:</strong> ${tags.phone}</p>
        <p><strong>Сайт:</strong> <a href="${tags.website}" target="_blank">${tags.website}</a></p>
      `;
      container.appendChild(card);
    });

    if (filtered.length === 0) {
      container.innerHTML = '<p>Ничего не найдено с полными данными.</p>';
    }

  } catch (error) {
    container.innerHTML = '<p>Ошибка загрузки данных.</p>';
    console.error(error);
  } finally {
    spinner.style.display = 'none'; // скрыть спиннер
  }
}

  </script>
</body>
</html>
